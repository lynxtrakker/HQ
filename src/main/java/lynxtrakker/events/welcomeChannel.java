package lynxtrakker.events;

import club.minnced.discord.webhook.WebhookClient;
import club.minnced.discord.webhook.WebhookClientBuilder;
import club.minnced.discord.webhook.send.WebhookEmbedBuilder;
import club.minnced.discord.webhook.send.WebhookMessageBuilder;
import io.github.cdimascio.dotenv.Dotenv;
import net.dv8tion.jda.api.entities.Guild;
import net.dv8tion.jda.api.entities.emoji.Emoji;
import net.dv8tion.jda.api.events.guild.member.GuildMemberJoinEvent;
import net.dv8tion.jda.api.events.message.MessageReceivedEvent;
import net.dv8tion.jda.api.hooks.ListenerAdapter;

public class welcomeChannel extends ListenerAdapter {
    Dotenv env = Dotenv.configure().ignoreIfMalformed().ignoreIfMissing().load(); //Load the .env file to be used
    String webhookURL = env.get("WEBHOOKURL");
    private final WebhookClient client;

    public welcomeChannel() {
        WebhookClientBuilder builder = new WebhookClientBuilder(webhookURL);
        builder.setThreadFactory((job) -> {
            Thread thread = new Thread(job);
            thread.setName("welChannel");
            thread.setDaemon(true);
            return thread;
        });
        this.client = builder.build();
    }

    @Override
    public void onGuildMemberJoin(GuildMemberJoinEvent event) {

        Guild guild = event.getGuild();
        if (guild.getIdLong() == Long.parseLong(env.get("LYNXMAIN"))) {
            WebhookEmbedBuilder builder = new WebhookEmbedBuilder()
                    .setColor(232323)
                    .setDescription("Welcome to the server " + event.getUser().getAsMention() + "!");
            WebhookMessageBuilder messageBuilder = new WebhookMessageBuilder()
                    .setUsername("Welcome Bot")
                    .setAvatarUrl("data:image/jpeg;base64,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")
                    .addEmbeds(builder.build());
            client.send(messageBuilder.build());
        }
    }

    @Override
    public void onMessageReceived(MessageReceivedEvent event) {
        if (event.getMessage().getContentRaw().toLowerCase().contains("welcome")){
            event.getMessage().addReaction(Emoji.fromUnicode("\uD83D\uDC4B")).queue();
        }
    }
}
